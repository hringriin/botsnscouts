package de.botsnscouts.build;

import java.io.*;
import java.util.*;

public class GenerateTilesIndex{

  

    public static void main(String[] args){
	if (args.length==0){
	    System.err.println("usage: java GenerateTilesIndex <pathToTilesDir>");
	    throw new RuntimeException();
	}

	new GenerateTilesIndex().generate(args[0]);
    }

    public void generate(String dirname){
	File dir=new File(dirname);

	SuffixFilter filter=new SuffixFilter();
	filter.setSuffix("rra");
	File[] tiles=dir.listFiles(filter);
	filter.setSuffix("spf");
	File[] boards=dir.listFiles(filter);

	Properties prop=new Properties();
	prop.setProperty("numTiles",""+tiles.length);
	prop.setProperty("numSpf",""+boards.length);
	for (int i=0;i<tiles.length;i++)
	    prop.setProperty("tile"+i,tiles[i].getName());
	for (int i=0;i<boards.length;i++){
	    String data=boards[i].getName();
	    // cut off .spf ending
	    data=data.substring(0,data.length()-4);
	    prop.setProperty("spf"+i,data);
	}

	FileOutputStream out;
	try{
	    out=new FileOutputStream(dirname+System.getProperty("file.separator")+"tile.index");
	}catch(FileNotFoundException e){
	    System.err.println("couldn't open output file!");
	    throw new RuntimeException();
	}
	try{
	    prop.store(out,"Index for tiles and boards. Autogenerated by GenerateTilesIndex");
	    out.close();
	}catch(IOException e){
	    System.err.println("couldn't write to output file!");
	    throw new RuntimeException();
	}
    }

    private class SuffixFilter implements FilenameFilter{
	private String suffix;
	public void setSuffix(String s){ suffix=s; }
	public boolean accept(File dir, String name){
	    try{
	        return(name.toLowerCase().endsWith(suffix));
	    } catch(Throwable t){return false;}
	}
    }
}
